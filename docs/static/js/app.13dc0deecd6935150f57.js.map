{"version":3,"sources":["webpack:///src/components/LevelView3D.vue","webpack:///./src/components/LevelView3D.vue?7d6a","webpack:///./src/components/LevelView3D.vue","webpack:///./src/services/WorldService.js","webpack:///src/components/LevelLoadSave.vue","webpack:///./src/components/LevelLoadSave.vue?0262","webpack:///./src/components/LevelLoadSave.vue","webpack:///src/components/ThingList.vue","webpack:///./src/components/ThingList.vue?dac7","webpack:///./src/components/ThingList.vue","webpack:///src/components/ThingInspector.vue","webpack:///./src/components/ThingInspector.vue?fc7b","webpack:///./src/components/ThingInspector.vue","webpack:///src/App.vue","webpack:///./src/App.vue?693d","webpack:///./src/App.vue","webpack:///./src/main.js"],"names":["render","forward","rotX","rotY","camera","renderFunc","mouseMove","ev","offsetX","offsetY","renderer","meshThingMap","raycaster","three_module","oldMaterial","selectedMaterial","keys","oldX","LevelView3D","world","dirLight","ambLight","mesh","whiteMat","greenMat","redMat","x","y","z","thing","levelGroup","_world","material","devicePixelRatio","domElement","requestPointerLock","clickPos","children","uuid","exitPointerLock","components_LevelView3D","_h","this","$createElement","_self","_c","staticClass","staticRenderFns","src_components_LevelView3D","__webpack_require__","normalizeComponent","ssrContext","worldXML","dom","things","querySelectorAll","forEach","pos","querySelector","customName","obj","id","innerHTML","type","name","t","parent","push","title","length","worldBIN","LevelLoadSave","target","FileReader","DOMParser","file","bin","buffer","num","chunkSize","arrSize","_xyz","offset","xyz","zOffset","chunkArray","chunks","outBuffer","canvas","_iteratorNormalCompletion","chunk","_step","value","c","_step2","voxels","XMLSerializer","components_LevelLoadSave","attrs","accept","on","change","loadWorld","_v","loadWorldBin","_s","_e","src_components_LevelLoadSave","LevelLoadSave_normalizeComponent","ThingList","components_ThingList","_vm","_l","click","$event","select","src_components_ThingList","ThingList_normalizeComponent","ThingInspector","components_ThingInspector","src_components_ThingInspector","ThingInspector_normalizeComponent","selectortype_template_index_0_src_App","players","selected","src_App","App_normalizeComponent","App","vue_esm","config","productionTip","document","bus","el","template","components"],"mappings":"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","file":"static/js/app.13dc0deecd6935150f57.js","sourcesContent":["<template>\n\t<div class=\"level-view\"></div>\n</template>\n\n<script>\nimport {Scene, PerspectiveCamera, WebGLRenderer, BoxBufferGeometry, MeshPhongMaterial, Mesh, SmoothShading, DirectionalLight, AmbientLight, Group, Quaternion, Vector3, Vector2, Raycaster} from 'three';\n\nlet renderer, scene, camera, levelGroup, dirLight, ambLight;\nlet didSetup;\nlet rotX = -0.8, rotY = 0;\n\nlet meshThingMap = [];\nlet raycaster = new Raycaster();\nlet oldMaterial;\nlet selectedMaterial;\n\nlet renderFunc = render;\nlet keys = [];\n\nlet forward = new Vector3(1, 0, 0);\n\nfunction render() {\n  camera.getWorldDirection(forward);\n  forward.multiplyScalar(0.3);\n\n  // Get keys\n  if (keys[87]) { // W\n    camera.position.add(forward);\n  }\n  if (keys[65]) { // A\n    //camera.position.add(forward);\n  }\n  if (keys[83]) { // S\n    camera.position.add(forward.multiplyScalar(-1));\n  }\n  if (keys[68]) { // D\n    //camera.position.add(forward);\n  }\n\n  // Update camera rotation\n  camera.setRotationFromQuaternion(new Quaternion(0, 0, 0, 1));\n  camera.rotateOnWorldAxis(new Vector3(1, 0, 0), rotX);\n  camera.rotateOnWorldAxis(new Vector3(0, 1, 0), rotY);\n\n\n  renderer.render( scene, camera );\n  window.requestAnimationFrame(renderFunc);\n}\n\nlet oldX, oldY;\nfunction mouseMove(ev) {\n  if (oldX) {\n    rotY -= ev.movementX / 1000;\n    rotX -= ev.movementY / 1000;\n  }\n\n  oldX = ev.offsetX;\n  oldY = ev.offsetY;\n}\n\nfunction init(world) {\n  meshThingMap = [];\n\n  camera = new PerspectiveCamera( 70, 1, 1, 1000 );\n\n  camera.position.z = 50;\n  camera.position.y = 50;\n\n  camera.rotation.x = -0.8;\n\n  scene = new Scene();\n\n  let smlGeo = new BoxBufferGeometry( 0.2, 0.2, 0.2 );\n  let midGeo = new BoxBufferGeometry( 0.4, 0.4, 0.4 );\n  let bigGeo = new BoxBufferGeometry( 2, 2, 2 );\n  let whiteMat = new MeshPhongMaterial( { color: 0xffffff } );\n  let redMat = new MeshPhongMaterial( { color: 0xff1111 } );\n  let greenMat = new MeshPhongMaterial( { color: 0x11ff11 } );\n  selectedMaterial = new MeshPhongMaterial( { color: 0xffff11 } );\n\n\n  dirLight = new DirectionalLight( 0xffffdd, 0.5 );\n  dirLight.position.set( -10, 300.75, 500 );\n  scene.add( dirLight );\n\n  ambLight = new AmbientLight( 0xffffff, 0.5 );\n  scene.add( ambLight );\n\n  levelGroup = new Group();\n\n  world.things.forEach((thing) => {\n    let mesh;\n    \n    if (thing.type.indexOf('StructureFrame', 0) === 0) {\n      mesh = new Mesh( bigGeo, whiteMat );\n    } else if (thing.parent) {\n      mesh = new Mesh( smlGeo, greenMat );\n    } else {\n      mesh = new Mesh( midGeo, redMat );\n    } \n\n    mesh.position.x = thing.pos.x;\n    mesh.position.y = thing.pos.y;\n    mesh.position.z = thing.pos.z;\n\n    levelGroup.add(mesh);\n\n    thing.mesh = mesh;\n    meshThingMap[thing.mesh.uuid] = thing;\n  });\n\n  scene.add(levelGroup);\n}\n\nexport default {\n  props: [ 'world', 'selected' ],\n  watch: {\n    world: function (world) {\n      init(world);\n\n      window.requestAnimationFrame(render);\n      didSetup = true;\n    },\n    selected: function(thing, oldThing) {\n      if (oldThing.mesh) {\n        oldThing.mesh.material = oldMaterial;\n      }\n\n      oldMaterial = thing.mesh.material;\n      thing.mesh.material = selectedMaterial;\n\n      oldThing = thing;\n    }\n  },\n  mounted () {\n    window.onkeyup = function(e) {\n      keys[e.keyCode]=false; \n      //console.log(e.keyCode);\n    }\n    window.onkeydown = function(e) {keys[e.keyCode]=true;}\n\n    renderer = new WebGLRenderer();\n    renderer.setPixelRatio( window.devicePixelRatio );\n    renderer.setSize( 600, 600 );\n    this.$el.appendChild( renderer.domElement );    \n\n    // Set up mouse locking\n    renderer.domElement.oncontextmenu = function (ev) {\n      return false;\n    }\n    renderer.domElement.onmousedown = function (ev) {\n      if (ev.button === 2) { // Right click - drag to look around\n        renderer.domElement.requestPointerLock();\n        document.addEventListener(\"mousemove\", mouseMove, false);\n      } else if (ev.button === 0) { // Left click - select\n        let clickPos = new Vector2((ev.offsetX / ev.target.clientWidth) * 2 - 1, -(ev.offsetY / ev.target.clientHeight) * 2 + 1);\n        console.log(clickPos);\n        raycaster.setFromCamera( clickPos, camera );\n        var intersects = raycaster.intersectObjects( levelGroup.children );\n        if (intersects.length) {\n          document.bus.$emit(\"thing-selected\", meshThingMap[intersects[0].object.uuid]);\n        }\n      }\n      return false;\n    };\n    renderer.domElement.onmouseup = function (ev) {\n      document.exitPointerLock();\n      document.removeEventListener(\"mousemove\", mouseMove, false);\n      return false;\n    };\n  }\n}\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style scoped>\n\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/LevelView3D.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"level-view\"})}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-1d5e2831\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/LevelView3D.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-1d5e2831\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./LevelView3D.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./LevelView3D.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./LevelView3D.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-1d5e2831\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./LevelView3D.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-1d5e2831\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/LevelView3D.vue\n// module id = null\n// module chunks = ","export default class WorldService {\n  static createWorldFromXML(worldXML) {\n    let world = {};\n\n    world.dom = worldXML;\n    world.things = [];\n\n    // Process all the things\n    let things = worldXML.querySelectorAll(\"ThingSaveData\");\n    \n    things.forEach(function(thing) {\n      let pos = thing.querySelector(\"WorldPosition\");\n      let customName = thing.querySelector(\"CustomName\");\n      let obj = {\n        id: thing.querySelector(\"ReferenceId\").innerHTML * 1,\n        dom: thing,\n        type: thing.querySelector(\"PrefabName\").innerHTML,\n        name: customName.innerHTML,\n        pos: { \n          x: pos.querySelector(\"x\").innerHTML * 1, \n          y: pos.querySelector(\"y\").innerHTML * 1, \n          z: pos.querySelector(\"z\").innerHTML * 1\n        },\n        children: []\n      };\n\n      world.things[obj.id] = obj;\n    });\n    \n    world.things.forEach((t) => {\n      let id = t.dom.querySelector(\"ParentReferenceId\");\n      if (id) {\n        t.parent = world.things[id.innerHTML];\n        if (t.parent) {\n          world.things[id.innerHTML].children.push(t);\n        }\n      }\n    });\n\n\n    world.title = things.length + \" loaded things.\";\n\n    return world;\n  }\n\n  static addTerrainFromBin(world, worldBIN) {\n    \n  }\n}\n\n\n// WEBPACK FOOTER //\n// ./src/services/WorldService.js","<template>\n  <div id=\"loadsave\">\n    <label class=\"button\">\n      <input type=\"file\" accept=\".xml\" name=\"file\" @change=\"loadWorld\">\n      Load World\n    </label>\n    <label class=\"button\">\n      <input type=\"file\" accept=\".bin\" name=\"binfile\" @change=\"loadWorldBin\">\n      Load WorldBin\n    </label>\n    <!-- <div class=\"button\" @click=\"saveWorld\">\n      Save Copy of World\n    </div> -->\n    <div>\n      <h3 v-if=\"world\">{{world.title}}</h3>\n    </div>\n  </div>\n</template>\n\n<script>\nimport WorldService from '@/services/WorldService';\nimport { decompressBlock } from 'lz4js'\n\nexport default {\n  props: ['world'],\n  data () {\n    let vm = this;\n    \n    return {\n      loadWorld (el) {\n        let input = el.target;\n        let file = input.files[0];\n        let reader = new FileReader();\n\n        if (!file) return;\n\n        reader.onload = function(ev) {\n          let parse = new DOMParser();\n          let dom = parse.parseFromString(ev.target.result, \"text/xml\");\n          \n          let world = WorldService.createWorldFromXML(dom);\n\n          document.bus.$emit(\"world-loaded\", world);\n\n          input.value = \"\";\n        }\n\n        reader.readAsText(file);\n      },      \n      loadWorldBin (el) {\n        let input = el.target;\n        let file = input.files[0];\n        let reader = new FileReader();\n\n        if (!vm.world) return;\n        if (!file) return;\n\n        reader.onload = function(ev) {\n          let world = vm.world;\n          let buffer = new Uint8Array(ev.target.result, 12);\n          let outBuffer = new Uint8Array(102400000);\n\n          console.log(decompressBlock(buffer, outBuffer, 0, buffer.byteLength, 0));\n        \n          // // OUTPUT DEBUG\n          // var blob = new Blob([outBuffer], {type: \"application/octet-stream\"});\n          // var objectUrl = URL.createObjectURL(blob);\n          // window.open(objectUrl);\n\n          world.voxels = loadVoxels(outBuffer);\n          drawVoxels(world.voxels);\n\n          document.bus.$emit(\"world-loaded\", world);\n\n          input.value = \"\";\n        }\n\n        reader.readAsArrayBuffer(file);\n      },\n      saveWorld () {\n          let ser = new XMLSerializer();\n          // TODO: Change this to download a file\n          //document.querySelector(\"#out\").value = ser.serializeToString(dom);\n      }\n    }\n  }\n}\n\nfunction loadVoxels(bin) {\n  let dv = new DataView(bin.buffer);\n\n  let chunkCount = dv.getInt32(0, true);\n  let chunkSize = dv.getInt32(4, true);\n\n  let chunks = [];\n\n  let idx = 8;\n  for (let i = 0; i < chunkCount; i++) {\n    let x = dv.getFloat32(idx+0, true);\n    let y = dv.getFloat32(idx+4, true);\n    let z = dv.getFloat32(idx+8, true);\n    let num = dv.getInt32(idx+12, true);\n    idx += 16;\n\n    console.log(\"\"+x+\" | \"+y+\" | \"+z+\" |  *\" + num);\n\n    let arrSize = chunkSize*chunkSize*chunkSize;\n    console.log(arrSize);\n    let chunkArray = new Array(arrSize);\n\n    for (let j = 0; j < num; j++) {\n      let offset = dv.getInt16(idx+0, true);\n      let [xOffset, yOffset, zOffset] = xyz(offset);\n\n      chunkArray[offset] = {\n        xOffset, yOffset, zOffset,\n        type: dv.getInt8(idx+2, true),\n        density: dv.getInt8(idx+3, true),\n      };\n      idx += 4;\n    }\n\n    chunks.push({\n      data: chunkArray,\n      x: x,\n      y: y,\n      z: z\n    });\n  }\n\n  console.log(\"[} \" + chunkCount + \" chunks * \" + chunkSize);\n  return chunks;\n}\n\nfunction xyz(offset) {\n  return [offset % 8, offset / 8 % 8, offset / 64];\n}\n\nfunction drawVoxels(chunks) {\n  let canvas = document.createElement(\"canvas\");\n  canvas.style.width = \"512px\";\n  canvas.style.height = \"512px\";\n  let ctx = canvas.getContext('2d');\n\n  document.querySelector(\"body\").appendChild(canvas);\n\n  ctx.fillStyle = 'rgb(0, 0, 0)';\n  ctx.fillRect(0, 0, 512, 512);\n\n  for (let chunk of chunks) {\n\n    for (let c of chunk.data) {\n      if (!c) continue;\n      let [x, y, z] = [c.xOffset + chunk.x + 100, c.yOffset + chunk.y, c.zOffset + chunk.z + 100]\n      let val = 128 + y * 5;\n      ctx.fillStyle = 'rgb('+val+', '+val+', '+val+')';\n      ctx.fillRect(x, z, 1, 1);\n    }\n  }\n}\n\n</script>\n\n<!-- Add \"scoped\" attribute to limit CSS to this component only -->\n<style scoped>\n#loadsave {\n  margin: 20px;\n  display: flex;\n  flex-direction: column;\n}\n\ninput[type=file] {\n  display: none;\n}\n\n.button {\n  margin: 5px;\n  padding: 3px 5px;\n\n  background-color: #e77;\n  border: 3px solid #c11;\n\n  color: white;\n  font-weight: bold;\n  font-size: 12pt;\n  \n  user-select: none;\n}\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/LevelLoadSave.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"loadsave\"}},[_c('label',{staticClass:\"button\"},[_c('input',{attrs:{\"type\":\"file\",\"accept\":\".xml\",\"name\":\"file\"},on:{\"change\":_vm.loadWorld}}),_vm._v(\"\\n    Load World\\n  \")]),_vm._v(\" \"),_c('label',{staticClass:\"button\"},[_c('input',{attrs:{\"type\":\"file\",\"accept\":\".bin\",\"name\":\"binfile\"},on:{\"change\":_vm.loadWorldBin}}),_vm._v(\"\\n    Load WorldBin\\n  \")]),_vm._v(\" \"),_c('div',[(_vm.world)?_c('h3',[_vm._v(_vm._s(_vm.world.title))]):_vm._e()])])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-7123aa70\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/LevelLoadSave.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-7123aa70\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./LevelLoadSave.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./LevelLoadSave.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./LevelLoadSave.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-7123aa70\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./LevelLoadSave.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-7123aa70\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/LevelLoadSave.vue\n// module id = null\n// module chunks = ","<template>\n  <ul class=\"thing-list\">\n    <li class=\"thing-item\" v-for=\"thing in things\" @click=\"select(thing)\">\n      {{thing.name || thing.type}}\n    </li>\n  </ul>\n</template>\n\n<script>\nexport default {\n  props: ['things', 'title'],\n  methods: {\n    select: function(thing) {\n      document.bus.$emit(\"thing-selected\", thing);\n    }\n  }\n}\n</script>\n\n<style scoped>\n  .thing-item:hover {\n    text-decoration: underline;\n  }\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/components/ThingList.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('ul',{staticClass:\"thing-list\"},_vm._l((_vm.things),function(thing){return _c('li',{staticClass:\"thing-item\",on:{\"click\":function($event){_vm.select(thing)}}},[_vm._v(\"\\n    \"+_vm._s(thing.name || thing.type)+\"\\n  \")])}))}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-3a0976d0\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/ThingList.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-3a0976d0\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./ThingList.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./ThingList.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./ThingList.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-3a0976d0\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./ThingList.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-3a0976d0\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/ThingList.vue\n// module id = null\n// module chunks = ","<template>\n  <div class=\"inspector\">\n    <h3>{{thing.name}}</h3>\n    <ul>\n      <li>{{thing.type}}</li>\n      <li>{{thing.pos}}</li>\n    </ul>\n    <h5>Contents:</h5>\n    <ThingList :things=\"thing.children\" />\n  </div>\n</template>\n\n<script>\nimport ThingList from './ThingList';\n\nexport default {\n  props: ['thing'],\n  components: {\n    ThingList\n  }\n}\n</script>\n\n<style scoped>\n.inspector {\n  margin: 20px;\n}\n</style>\n\n\n// WEBPACK FOOTER //\n// src/components/ThingInspector.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{staticClass:\"inspector\"},[_c('h3',[_vm._v(_vm._s(_vm.thing.name))]),_vm._v(\" \"),_c('ul',[_c('li',[_vm._v(_vm._s(_vm.thing.type))]),_vm._v(\" \"),_c('li',[_vm._v(_vm._s(_vm.thing.pos))])]),_vm._v(\" \"),_c('h5',[_vm._v(\"Contents:\")]),_vm._v(\" \"),_c('ThingList',{attrs:{\"things\":_vm.thing.children}})],1)}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-04972c03\",\"hasScoped\":true,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/components/ThingInspector.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-04972c03\\\",\\\"scoped\\\":true,\\\"hasInlineConfig\\\":false}!../../node_modules/vue-loader/lib/selector?type=styles&index=0!./ThingInspector.vue\")\n}\nvar normalizeComponent = require(\"!../../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./ThingInspector.vue\"\nimport __vue_script__ from \"!!babel-loader!../../node_modules/vue-loader/lib/selector?type=script&index=0!./ThingInspector.vue\"\n/* template */\nimport __vue_template__ from \"!!../../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-04972c03\\\",\\\"hasScoped\\\":true,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../../node_modules/vue-loader/lib/selector?type=template&index=0!./ThingInspector.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = \"data-v-04972c03\"\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/components/ThingInspector.vue\n// module id = null\n// module chunks = ","<template>\n  <div id=\"app\">\n    <div id=\"left-panel\">\n      <LevelLoadSave :world=\"world\" />\n      <h3>Players:</h3>\n      <ThingList :things=\"players\" />\n    </div>\n    <div id=\"center\">\n      <LevelView3D :world=\"world\" :selected=\"selected\" />\n    </div>\n    <div id=\"right-panel\">\n      <ThingInspector :thing=\"selected\" />\n    </div>\n  </div>\n</template>\n\n<script>\nimport LevelView3D from './components/LevelView3D';\nimport LevelLoadSave from './components/LevelLoadSave';\nimport ThingList from './components/ThingList';\nimport ThingInspector from './components/ThingInspector';\n\nimport { filter } from 'lodash'\n\nexport default {\n  name: 'app',\n  data () {\n    return {\n      world: {},\n      selected: {}\n    }\n  },\n  computed: {\n    players () {\n      return filter(this.world.things, (t) => { return t && t.type === 'Character' });\n    }\n  },\n  created () {\n    let vm = this;\n    let oldMaterial;\n\n    document.bus.$on(\"world-loaded\", (world) => {\n      vm.world = world;\n    });\n    document.bus.$on(\"thing-selected\", (thing) => {\n      vm.selected = thing;\n      // Mesh change here\n    });\n  },\n  components: {\n    LevelView3D,\n    LevelLoadSave,\n    ThingList,\n    ThingInspector\n  }\n}\n</script>\n\n<style>\nbody {\n  background: #f0f0f0;\n}\n\n#app {\n  font-family: 'Avenir', Helvetica, Arial, sans-serif;\n  -webkit-font-smoothing: antialiased;\n  -moz-osx-font-smoothing: grayscale;\n  text-align: center;\n  color: #2c3e50;\n  margin-top: 60px;\n  display: flex;\n}\n\n#left-panel {\n  display: flex;\n  flex-direction: column;\n}\n</style>\n\n\n\n// WEBPACK FOOTER //\n// src/App.vue","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('div',{attrs:{\"id\":\"app\"}},[_c('div',{attrs:{\"id\":\"left-panel\"}},[_c('LevelLoadSave',{attrs:{\"world\":_vm.world}}),_vm._v(\" \"),_c('h3',[_vm._v(\"Players:\")]),_vm._v(\" \"),_c('ThingList',{attrs:{\"things\":_vm.players}})],1),_vm._v(\" \"),_c('div',{attrs:{\"id\":\"center\"}},[_c('LevelView3D',{attrs:{\"world\":_vm.world,\"selected\":_vm.selected}})],1),_vm._v(\" \"),_c('div',{attrs:{\"id\":\"right-panel\"}},[_c('ThingInspector',{attrs:{\"thing\":_vm.selected}})],1)])}\nvar staticRenderFns = []\nvar esExports = { render: render, staticRenderFns: staticRenderFns }\nexport default esExports\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./node_modules/vue-loader/lib/template-compiler?{\"id\":\"data-v-14eabed9\",\"hasScoped\":false,\"transformToRequire\":{\"video\":[\"src\",\"poster\"],\"source\":\"src\",\"img\":\"src\",\"image\":\"xlink:href\"},\"buble\":{\"transforms\":{}}}!./node_modules/vue-loader/lib/selector.js?type=template&index=0!./src/App.vue\n// module id = null\n// module chunks = ","function injectStyle (ssrContext) {\n  require(\"!!../node_modules/extract-text-webpack-plugin/dist/loader.js?{\\\"omit\\\":1,\\\"remove\\\":true}!vue-style-loader!css-loader?{\\\"sourceMap\\\":true}!../node_modules/vue-loader/lib/style-compiler/index?{\\\"vue\\\":true,\\\"id\\\":\\\"data-v-14eabed9\\\",\\\"scoped\\\":false,\\\"hasInlineConfig\\\":false}!../node_modules/vue-loader/lib/selector?type=styles&index=0!./App.vue\")\n}\nvar normalizeComponent = require(\"!../node_modules/vue-loader/lib/component-normalizer\")\n/* script */\nexport * from \"!!babel-loader!../node_modules/vue-loader/lib/selector?type=script&index=0!./App.vue\"\nimport __vue_script__ from \"!!babel-loader!../node_modules/vue-loader/lib/selector?type=script&index=0!./App.vue\"\n/* template */\nimport __vue_template__ from \"!!../node_modules/vue-loader/lib/template-compiler/index?{\\\"id\\\":\\\"data-v-14eabed9\\\",\\\"hasScoped\\\":false,\\\"transformToRequire\\\":{\\\"video\\\":[\\\"src\\\",\\\"poster\\\"],\\\"source\\\":\\\"src\\\",\\\"img\\\":\\\"src\\\",\\\"image\\\":\\\"xlink:href\\\"},\\\"buble\\\":{\\\"transforms\\\":{}}}!../node_modules/vue-loader/lib/selector?type=template&index=0!./App.vue\"\n/* template functional */\nvar __vue_template_functional__ = false\n/* styles */\nvar __vue_styles__ = injectStyle\n/* scopeId */\nvar __vue_scopeId__ = null\n/* moduleIdentifier (server only) */\nvar __vue_module_identifier__ = null\nvar Component = normalizeComponent(\n  __vue_script__,\n  __vue_template__,\n  __vue_template_functional__,\n  __vue_styles__,\n  __vue_scopeId__,\n  __vue_module_identifier__\n)\n\nexport default Component.exports\n\n\n\n//////////////////\n// WEBPACK FOOTER\n// ./src/App.vue\n// module id = null\n// module chunks = ","// The Vue build version to load with the `import` command\n// (runtime-only or standalone) has been set in webpack.base.conf with an alias.\nimport Vue from 'vue'\nimport App from './App'\n\nVue.config.productionTip = false\n\ndocument.bus = new Vue()\n\n/* eslint-disable no-new */\nnew Vue({\n  el: '#app',\n  template: '<App/>',\n  components: { App }\n})\n\n\n\n// WEBPACK FOOTER //\n// ./src/main.js"],"sourceRoot":""}