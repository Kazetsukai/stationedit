webpackJsonp([1],{MSLb:function(e,t){},NHnr:function(e,t,n){"use strict";function i(){var e=d.getWorldDirection();e.multiplyScalar(.3),_[87]&&d.position.add(e),_[65],_[83]&&d.position.add(e.multiplyScalar(-1)),_[68],d.setRotationFromQuaternion(new s.h(0,0,0,1)),d.rotateOnWorldAxis(new s.m(1,0,0),f),d.rotateOnWorldAxis(new s.m(0,1,0),v),a.render(l,d),window.requestAnimationFrame(y)}function o(e){L&&(v-=e.movementX/1e3,f-=e.movementY/1e3),L=e.offsetX,e.offsetY}Object.defineProperty(t,"__esModule",{value:!0});var r=n("7+uW"),s=n("Ml+6"),a=void 0,l=void 0,d=void 0,c=void 0,u=void 0,h=void 0,f=-.8,v=0,m=[],p=new s.i,w=void 0,g=void 0,y=i,_=[],L=void 0,b={props:["world","selected"],watch:{world:function(e){!function(e){m=[],(d=new s.g(70,1,1,1e3)).position.z=50,d.position.y=50,d.rotation.x=-.8,l=new s.j;var t=new s.b(.2,.2,.2),n=new s.b(.4,.4,.4),i=new s.b(2,2,2),o=new s.f({color:16777215,shading:s.k}),r=new s.f({color:16716049,shading:s.k}),a=new s.f({color:1179409,shading:s.k});g=new s.f({color:16776977,shading:s.k}),(u=new s.c(16777181,.5)).position.set(-10,300.75,500),l.add(u),h=new s.a(16777215,.5),l.add(h),c=new s.d,e.things.forEach(function(e){var l=void 0;(l=0===e.type.indexOf("StructureFrame",0)?new s.e(i,o):e.parent?new s.e(t,a):new s.e(n,r)).position.x=e.pos.x,l.position.y=e.pos.y,l.position.z=e.pos.z,c.add(l),e.mesh=l,m[e.mesh.uuid]=e}),l.add(c)}(e),window.requestAnimationFrame(i),!0},selected:function(e,t){t.mesh&&(t.mesh.material=w),w=e.mesh.material,e.mesh.material=g,t=e}},mounted:function(){window.onkeyup=function(e){_[e.keyCode]=!1},window.onkeydown=function(e){_[e.keyCode]=!0},(a=new s.n).setPixelRatio(window.devicePixelRatio),a.setSize(600,600),this.$el.appendChild(a.domElement),a.domElement.oncontextmenu=function(e){return!1},a.domElement.onmousedown=function(e){if(2===e.button)a.domElement.requestPointerLock(),document.addEventListener("mousemove",o,!1);else if(0===e.button){var t=new s.l(e.offsetX/e.target.clientWidth*2-1,-e.offsetY/e.target.clientHeight*2+1);console.log(t),p.setFromCamera(t,d);var n=p.intersectObjects(c.children);n.length&&document.bus.$emit("thing-selected",m[n[0].object.uuid])}return!1},a.domElement.onmouseup=function(e){return document.exitPointerLock(),document.removeEventListener("mousemove",o,!1),!1}}},x={render:function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"level-view"})},staticRenderFns:[]},F=n("VU/8")(b,x,!1,function(e){n("MSLb")},"data-v-072f7025",null).exports,S=n("Zrlr"),T=n.n(S),M=n("wxAW"),k=n.n(M),W=function(){function e(){T()(this,e)}return k()(e,null,[{key:"createWorldFromXML",value:function(e){var t={};t.dom=e,t.things=[];var n=e.querySelectorAll("ThingSaveData");return n.forEach(function(e){var n=e.querySelector("WorldPosition"),i=e.querySelector("CustomName"),o={id:1*e.querySelector("ReferenceId").innerHTML,dom:e,type:e.querySelector("PrefabName").innerHTML,name:i.innerHTML,pos:{x:1*n.querySelector("x").innerHTML,y:1*n.querySelector("y").innerHTML,z:1*n.querySelector("z").innerHTML},children:[]};t.things[o.id]=o}),t.things.forEach(function(e){var n=e.dom.querySelector("ParentReferenceId");n&&(e.parent=t.things[n.innerHTML],e.parent&&t.things[n.innerHTML].children.push(e))}),t.title=n.length+" loaded things.",t}},{key:"addTerrainFromBin",value:function(e,t){}}]),e}(),E=n("b+as"),A={props:["world"],data:function(){var e=this;return{loadWorld:function(e){var t=e.target,n=t.files[0],i=new FileReader;n&&(i.onload=function(e){var n=(new DOMParser).parseFromString(e.target.result,"text/xml"),i=W.createWorldFromXML(n);document.bus.$emit("world-loaded",i),t.value=""},i.readAsText(n))},loadWorldBin:function(t){var n=t.target,i=n.files[0],o=new FileReader;e.world&&i&&(o.onload=function(t){var i=e.world,o=new Uint8Array(t.target.result,12),r=new Uint8Array(1024e4);console.log(Object(E.decompressBlock)(o,r,0,o.byteLength,0)),i.voxels=function(e){var t=new DataView(e.buffer),n=t.getInt32(0,!0),i=t.getInt32(1,!0);console.log(e[0]),console.log(e[1]);for(var o=8,r=0;r<n;r++){var s=t.getFloat32(o+0,!0),a=t.getFloat32(o+4,!0),l=t.getFloat32(o+8,!0),d=t.getInt32(o+12,!0);o+=16,console.log(s+" | "+a+" | "+l+" |  *"+d),o+=4*d}console.log("[} "+n+" chunks * "+i)}(r),document.bus.$emit("world-loaded",i),n.value=""},o.readAsArrayBuffer(i))},saveWorld:function(){new XMLSerializer}}}},C={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"loadsave"}},[t("label",{staticClass:"button"},[t("input",{attrs:{type:"file",accept:".xml",name:"file"},on:{change:this.loadWorld}}),this._v("\n    Load World\n  ")]),this._v(" "),t("label",{staticClass:"button"},[t("input",{attrs:{type:"file",accept:".bin",name:"binfile"},on:{change:this.loadWorldBin}}),this._v("\n    Load WorldBin\n  ")]),this._v(" "),t("div",[this.world?t("h3",[this._v(this._s(this.world.title))]):this._e()])])},staticRenderFns:[]},H=n("VU/8")(A,C,!1,function(e){n("p9x1")},"data-v-28a109bd",null).exports,q={props:["things","title"],methods:{select:function(e){document.bus.$emit("thing-selected",e)}}},R={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ul",{staticClass:"thing-list"},e._l(e.things,function(t){return n("li",{staticClass:"thing-item",on:{click:function(n){e.select(t)}}},[e._v("\n    "+e._s(t.name||t.type)+"\n  ")])}))},staticRenderFns:[]},$=n("VU/8")(q,R,!1,function(e){n("eBLH")},"data-v-3a0976d0",null).exports,P={props:["thing"],components:{ThingList:$}},B={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"inspector"},[t("h3",[this._v(this._s(this.thing.name))]),this._v(" "),t("ul",[t("li",[this._v(this._s(this.thing.type))]),this._v(" "),t("li",[this._v(this._s(this.thing.pos))])]),this._v(" "),t("h5",[this._v("Contents:")]),this._v(" "),t("ThingList",{attrs:{things:this.thing.children}})],1)},staticRenderFns:[]},O=n("VU/8")(P,B,!1,function(e){n("wfto")},"data-v-04972c03",null).exports,V=n("M4fF"),z={name:"app",data:function(){return{world:{},selected:{}}},computed:{players:function(){return Object(V.filter)(this.world.things,function(e){return e&&"Character"===e.type})}},created:function(){var e=this;document.bus.$on("world-loaded",function(t){e.world=t}),document.bus.$on("thing-selected",function(t){e.selected=t})},components:{LevelView3D:F,LevelLoadSave:H,ThingList:$,ThingInspector:O}},I={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("div",{attrs:{id:"left-panel"}},[t("LevelLoadSave",{attrs:{world:this.world}}),this._v(" "),t("h3",[this._v("Players:")]),this._v(" "),t("ThingList",{attrs:{things:this.players}})],1),this._v(" "),t("div",{attrs:{id:"center"}},[t("LevelView3D",{attrs:{world:this.world,selected:this.selected}})],1),this._v(" "),t("div",{attrs:{id:"right-panel"}},[t("ThingInspector",{attrs:{thing:this.selected}})],1)])},staticRenderFns:[]},U=n("VU/8")(z,I,!1,function(e){n("nyFg")},null,null).exports;r.a.config.productionTip=!1,document.bus=new r.a,new r.a({el:"#app",template:"<App/>",components:{App:U}})},eBLH:function(e,t){},nyFg:function(e,t){},p9x1:function(e,t){},wfto:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.13da6f635e737538ce68.js.map