webpackJsonp([1],{NHnr:function(e,t,n){"use strict";function i(){d.getWorldDirection(b),b.multiplyScalar(.3),_[87]&&d.position.add(b),_[65],_[83]&&d.position.add(b.multiplyScalar(-1)),_[68],d.setRotationFromQuaternion(new s.h(0,0,0,1)),d.rotateOnWorldAxis(new s.l(1,0,0),h),d.rotateOnWorldAxis(new s.l(0,1,0),v),a.render(l,d),window.requestAnimationFrame(y)}function o(e){x&&(v-=e.movementX/1e3,h-=e.movementY/1e3),x=e.offsetX,e.offsetY}Object.defineProperty(t,"__esModule",{value:!0});var r=n("7+uW"),s=n("Ml+6"),a=void 0,l=void 0,d=void 0,c=void 0,u=void 0,f=void 0,h=-.8,v=0,m=[],p=new s.i,w=void 0,g=void 0,y=i,_=[],b=new s.l(1,0,0),x=void 0,L={props:["world","selected"],watch:{world:function(e){!function(e){m=[],(d=new s.g(70,1,1,1e3)).position.z=50,d.position.y=50,d.rotation.x=-.8,l=new s.j;var t=new s.b(.2,.2,.2),n=new s.b(.4,.4,.4),i=new s.b(2,2,2),o=new s.f({color:16777215}),r=new s.f({color:16716049}),a=new s.f({color:1179409});g=new s.f({color:16776977}),(u=new s.c(16777181,.5)).position.set(-10,300.75,500),l.add(u),f=new s.a(16777215,.5),l.add(f),c=new s.d,e.things.forEach(function(e){var l=void 0;(l=0===e.type.indexOf("StructureFrame",0)?new s.e(i,o):e.parent?new s.e(t,a):new s.e(n,r)).position.x=e.pos.x,l.position.y=e.pos.y,l.position.z=e.pos.z,c.add(l),e.mesh=l,m[e.mesh.uuid]=e}),l.add(c)}(e),window.requestAnimationFrame(i),!0},selected:function(e,t){t.mesh&&(t.mesh.material=w),w=e.mesh.material,e.mesh.material=g,t=e}},mounted:function(){window.onkeyup=function(e){_[e.keyCode]=!1},window.onkeydown=function(e){_[e.keyCode]=!0},(a=new s.m).setPixelRatio(window.devicePixelRatio),a.setSize(600,600),this.$el.appendChild(a.domElement),a.domElement.oncontextmenu=function(e){return!1},a.domElement.onmousedown=function(e){if(2===e.button)a.domElement.requestPointerLock(),document.addEventListener("mousemove",o,!1);else if(0===e.button){var t=new s.k(e.offsetX/e.target.clientWidth*2-1,-e.offsetY/e.target.clientHeight*2+1);console.log(t),p.setFromCamera(t,d);var n=p.intersectObjects(c.children);n.length&&document.bus.$emit("thing-selected",m[n[0].object.uuid])}return!1},a.domElement.onmouseup=function(e){return document.exitPointerLock(),document.removeEventListener("mousemove",o,!1),!1}}},F={render:function(){var e=this.$createElement;return(this._self._c||e)("div",{staticClass:"level-view"})},staticRenderFns:[]},S=n("VU/8")(L,F,!1,function(e){n("X0bb")},"data-v-1d5e2831",null).exports,T=n("BO1k"),E=n.n(T),W=n("d7EF"),C=n.n(W),M=n("Zrlr"),O=n.n(M),k=n("wxAW"),A=n.n(k),R=function(){function e(){O()(this,e)}return A()(e,null,[{key:"createWorldFromXML",value:function(e){var t={};t.dom=e,t.things=[];var n=e.querySelectorAll("ThingSaveData");return n.forEach(function(e){var n=e.querySelector("WorldPosition"),i=e.querySelector("CustomName"),o={id:1*e.querySelector("ReferenceId").innerHTML,dom:e,type:e.querySelector("PrefabName").innerHTML,name:i.innerHTML,pos:{x:1*n.querySelector("x").innerHTML,y:1*n.querySelector("y").innerHTML,z:1*n.querySelector("z").innerHTML},children:[]};t.things[o.id]=o}),t.things.forEach(function(e){var n=e.dom.querySelector("ParentReferenceId");n&&(e.parent=t.things[n.innerHTML],e.parent&&t.things[n.innerHTML].children.push(e))}),t.title=n.length+" loaded things.",t}},{key:"addTerrainFromBin",value:function(e,t){}}]),e}(),q=n("b+as"),H={props:["world"],data:function(){var e=this;return{loadWorld:function(e){var t=e.target,n=t.files[0],i=new FileReader;n&&(i.onload=function(e){var n=(new DOMParser).parseFromString(e.target.result,"text/xml"),i=R.createWorldFromXML(n);document.bus.$emit("world-loaded",i),t.value=""},i.readAsText(n))},loadWorldBin:function(t){var n=t.target,i=n.files[0],o=new FileReader;e.world&&i&&(o.onload=function(t){var i=e.world,o=new Uint8Array(t.target.result,12),r=new Uint8Array(1024e5);console.log(Object(q.decompressBlock)(o,r,0,o.byteLength,0)),i.voxels=function(e){for(var t=new DataView(e.buffer),n=t.getInt32(0,!0),i=t.getInt32(4,!0),o=[],r=8,s=0;s<n;s++){var a=t.getFloat32(r+0,!0),l=t.getFloat32(r+4,!0),d=t.getFloat32(r+8,!0),c=t.getInt32(r+12,!0);r+=16,console.log(a+" | "+l+" | "+d+" |  *"+c);var u=i*i*i;console.log(u);for(var f=new Array(u),h=0;h<c;h++){var v=t.getInt16(r+0,!0),m=function(e){return[e%8,e/8%8,e/64]}(v),p=C()(m,3),w=p[0],g=p[1],y=p[2];f[v]={xOffset:w,yOffset:g,zOffset:y,type:t.getInt8(r+2,!0),density:t.getInt8(r+3,!0)},r+=4}o.push({data:f,x:a,y:l,z:d})}return console.log("[} "+n+" chunks * "+i),o}(r),function(e){var t=document.createElement("canvas");t.style.width="512px",t.style.height="512px";var n=t.getContext("2d");document.querySelector("body").appendChild(t),n.fillStyle="rgb(0, 0, 0)",n.fillRect(0,0,512,512);var i=!0,o=!1,r=void 0;try{for(var s,a=E()(e);!(i=(s=a.next()).done);i=!0){var l=s.value,d=!0,c=!1,u=void 0;try{for(var f,h=E()(l.data);!(d=(f=h.next()).done);d=!0){var v=f.value;if(v){var m=v.xOffset+l.x+100,p=v.yOffset+l.y,w=v.zOffset+l.z+100,g=128+5*p;n.fillStyle="rgb("+g+", "+g+", "+g+")",n.fillRect(m,w,1,1)}}}catch(e){c=!0,u=e}finally{try{!d&&h.return&&h.return()}finally{if(c)throw u}}}}catch(e){o=!0,r=e}finally{try{!i&&a.return&&a.return()}finally{if(o)throw r}}}(i.voxels),document.bus.$emit("world-loaded",i),n.value=""},o.readAsArrayBuffer(i))},saveWorld:function(){new XMLSerializer}}}},$={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"loadsave"}},[t("label",{staticClass:"button"},[t("input",{attrs:{type:"file",accept:".xml",name:"file"},on:{change:this.loadWorld}}),this._v("\n    Load World\n  ")]),this._v(" "),t("label",{staticClass:"button"},[t("input",{attrs:{type:"file",accept:".bin",name:"binfile"},on:{change:this.loadWorldBin}}),this._v("\n    Load WorldBin\n  ")]),this._v(" "),t("div",[this.world?t("h3",[this._v(this._s(this.world.title))]):this._e()])])},staticRenderFns:[]},z=n("VU/8")(H,$,!1,function(e){n("VDj3")},"data-v-7123aa70",null).exports,I={props:["things","title"],methods:{select:function(e){document.bus.$emit("thing-selected",e)}}},P={render:function(){var e=this,t=e.$createElement,n=e._self._c||t;return n("ul",{staticClass:"thing-list"},e._l(e.things,function(t){return n("li",{staticClass:"thing-item",on:{click:function(n){e.select(t)}}},[e._v("\n    "+e._s(t.name||t.type)+"\n  ")])}))},staticRenderFns:[]},V=n("VU/8")(I,P,!1,function(e){n("eBLH")},"data-v-3a0976d0",null).exports,B={props:["thing"],components:{ThingList:V}},j={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{staticClass:"inspector"},[t("h3",[this._v(this._s(this.thing.name))]),this._v(" "),t("ul",[t("li",[this._v(this._s(this.thing.type))]),this._v(" "),t("li",[this._v(this._s(this.thing.pos))])]),this._v(" "),t("h5",[this._v("Contents:")]),this._v(" "),t("ThingList",{attrs:{things:this.thing.children}})],1)},staticRenderFns:[]},D=n("VU/8")(B,j,!1,function(e){n("wfto")},"data-v-04972c03",null).exports,X=n("M4fF"),U={name:"app",data:function(){return{world:{},selected:{}}},computed:{players:function(){return Object(X.filter)(this.world.things,function(e){return e&&"Character"===e.type})}},created:function(){var e=this;document.bus.$on("world-loaded",function(t){e.world=t}),document.bus.$on("thing-selected",function(t){e.selected=t})},components:{LevelView3D:S,LevelLoadSave:z,ThingList:V,ThingInspector:D}},N={render:function(){var e=this.$createElement,t=this._self._c||e;return t("div",{attrs:{id:"app"}},[t("div",{attrs:{id:"left-panel"}},[t("LevelLoadSave",{attrs:{world:this.world}}),this._v(" "),t("h3",[this._v("Players:")]),this._v(" "),t("ThingList",{attrs:{things:this.players}})],1),this._v(" "),t("div",{attrs:{id:"center"}},[t("LevelView3D",{attrs:{world:this.world,selected:this.selected}})],1),this._v(" "),t("div",{attrs:{id:"right-panel"}},[t("ThingInspector",{attrs:{thing:this.selected}})],1)])},staticRenderFns:[]},Y=n("VU/8")(U,N,!1,function(e){n("nyFg")},null,null).exports;r.a.config.productionTip=!1,document.bus=new r.a,new r.a({el:"#app",template:"<App/>",components:{App:Y}})},VDj3:function(e,t){},X0bb:function(e,t){},eBLH:function(e,t){},nyFg:function(e,t){},wfto:function(e,t){}},["NHnr"]);
//# sourceMappingURL=app.13dc0deecd6935150f57.js.map